<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>File: README_SOLR.rdoc [NWDA Blacklight Documentation]</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='file' id='wrapper'>
      <div class='header'>
        <div class='name'>README_SOLR.rdoc</div>
        <div class='paths'>
          vendor/plugins/blacklight/README_SOLR.rdoc
        </div>
        <div class='last-update'>
          Last Update:
          <span class='datetime'>Sun Jun 14 19:22:49 -0400 2009</span>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            <h1>Solr in <a href="../../../../classes/Blacklight.html">Blacklight</a></h1>
            <h2>Setting up Solr</h2>
            <pre>Blacklight uses Solr as its &quot;search engine&quot;. Create a directory for a solr&#x000A;distribution and download the latest Solr nightly build:&#x000A;  cd &lt;my-new-solr-dir&gt;&#x000A;  wget http://people.apache.org/builds/lucene/solr/nightly/solr-2009-01-27.tgz&#x000A;&#x000A;Uncompress the file:&#x000A;  tar -xzvf solr-2009-01-27.tgz&#x000A;&#x000A;You now have a usable copy of Solr!&#x000A;&#x000A;More information about Solr is available at the Solr web site:&#x000A;  http://lucene.apache.org/solr/</pre>
            <h3>Solr Schema</h3>
            <pre>Solr uses a schema.xml file to define document fields (among other things).&#x000A;These fields store data for displaying and indexing. You can find the&#x000A;example/solr/conf/schema.xml file in the Solr distribution you just&#x000A;downloaded and uncompressed.&#x000A;&#x000A;Documentation about the Solr schema.xml file is available here:&#x000A;  http://wiki.apache.org/solr/SchemaXml&#x000A;&#x000A;The default schema.xml file comes with some preset fields made to work with&#x000A;the example data. If you don't already have a schema.xml setup, we&#x000A;recommend using a simplified &quot;fields&quot; section like this:&#x000A;      &lt;fields&gt;&#x000A;              &lt;field name=&quot;id&quot; type=&quot;string&quot; indexed=&quot;true&quot; stored=&quot;true&quot; required=&quot;true&quot; /&gt;&#x000A;              &lt;field name=&quot;text&quot; type=&quot;text&quot; indexed=&quot;true&quot; stored=&quot;false&quot; multiValued=&quot;true&quot;/&gt;&#x000A;              &lt;field name=&quot;timestamp&quot; type=&quot;date&quot; indexed=&quot;true&quot; stored=&quot;true&quot; default=&quot;NOW&quot; multiValued=&quot;false&quot;/&gt;&#x000A;              &lt;field name=&quot;spell&quot; type=&quot;textSpell&quot; indexed=&quot;true&quot; stored=&quot;true&quot; multiValued=&quot;true&quot;/&gt;&#x000A;              &lt;dynamicField name=&quot;*_i&quot;  type=&quot;sint&quot;    indexed=&quot;true&quot;  stored=&quot;true&quot;/&gt;&#x000A;              &lt;dynamicField name=&quot;*_s&quot;  type=&quot;string&quot;  indexed=&quot;true&quot;  stored=&quot;true&quot; multiValued=&quot;true&quot;/&gt;&#x000A;              &lt;dynamicField name=&quot;*_l&quot;  type=&quot;slong&quot;   indexed=&quot;true&quot;  stored=&quot;true&quot;/&gt;&#x000A;              &lt;dynamicField name=&quot;*_t&quot;  type=&quot;text&quot;    indexed=&quot;true&quot;  stored=&quot;true&quot; multiValued=&quot;true&quot;/&gt;&#x000A;              &lt;dynamicField name=&quot;*_b&quot;  type=&quot;boolean&quot; indexed=&quot;true&quot;  stored=&quot;true&quot;/&gt;&#x000A;              &lt;dynamicField name=&quot;*_f&quot;  type=&quot;sfloat&quot;  indexed=&quot;true&quot;  stored=&quot;true&quot;/&gt;&#x000A;              &lt;dynamicField name=&quot;*_d&quot;  type=&quot;sdouble&quot; indexed=&quot;true&quot;  stored=&quot;true&quot;/&gt;&#x000A;              &lt;dynamicField name=&quot;*_dt&quot; type=&quot;date&quot;    indexed=&quot;true&quot;  stored=&quot;true&quot;/&gt;&#x000A;              &lt;dynamicField name=&quot;random*&quot; type=&quot;random&quot; /&gt;&#x000A;              &lt;dynamicField name=&quot;*_facet&quot; type=&quot;string&quot; indexed=&quot;true&quot; stored=&quot;true&quot; multiValued=&quot;true&quot; /&gt;&#x000A;              &lt;dynamicField name=&quot;*_display&quot; type=&quot;string&quot; indexed=&quot;false&quot; stored=&quot;true&quot; /&gt;&#x000A;      &lt;/fields&gt;&#x000A;&#x000A;Simply replace the &quot;fields&quot; section in the schema.xml with the block above.&#x000A;&#x000A;Additionally, replace all of the tags after the &quot;fields&quot; section, and before&#x000A;the &lt;/schema&gt; tag with this:&#x000A;      &lt;uniqueKey&gt;id&lt;/uniqueKey&gt;&#x000A;      &lt;defaultSearchField&gt;text&lt;/defaultSearchField&gt;&#x000A;      &lt;solrQueryParser defaultOperator=&quot;OR&quot;/&gt;&#x000A;      &lt;copyField source=&quot;*_facet&quot; dest=&quot;text&quot;/&gt;&#x000A;&#x000A;Now you have a basic schema.xml file ready. The required fields used by the&#x000A;built in views are:&#x000A;  id&#x000A;  title_t (used to display the title for links)&#x000A;  format_code_t (used to select the partial views)&#x000A;&#x000A;Fields that are &quot;indexed&quot; are searchable.&#x000A;&#x000A;Fields that are &quot;stored&quot; are can be viewed/displayed from the Solr search&#x000A;results.&#x000A;&#x000A;The fields with asterisks ('*') in their names are &quot;dynamic&quot; fields. These&#x000A;allow you to create arbitrary tags at index time.&#x000A;&#x000A;The *_facet field can be used for creating your facets. When you index,&#x000A;simply define a field with _facet on the end:&#x000A;  category_facet&#x000A;&#x000A;The *_display field can be used for storing text that doesn't need to be&#x000A;indexed. An example would be the raw MARC for a record's detail view:&#x000A;  raw_marc_display&#x000A;&#x000A;For text that will be queried (and possibly displayed), use the *_t type&#x000A;field for tokenized text (text broken into pieces/words) or the *_s type&#x000A;for queries that should exactly match the field contents:&#x000A;  description_t&#x000A;  url_s&#x000A;&#x000A;The Blacklight application is generic enough to work with any Solr schema, but to&#x000A;manipulate the search results and single record displays, you'll need to know the&#x000A;stored fields in your indexed documents.&#x000A;&#x000A;For more information, refer to the Solr documentation:&#x000A;  http://wiki.apache.org/solr/SchemaXml</pre>
            <h3>Solr Config</h3>
            <pre>Solr also uses a solrconfig.xml file to define request handlers, set cache&#x000A;options, etc. You can find the examples/solr/conf/solrconfig.xml in the&#x000A;distribution directory you just uncompressed.&#x000A;&#x000A;Documentation about the solrconfig.xml file is available here:&#x000A;  http://wiki.apache.org/solr/SolrConfigXml&#x000A;&#x000A;Blacklight expects a few things to be setup in the solrconfig.xml file,&#x000A;namely two special request handler definitions.&#x000A;&#x000A;You MUST set up these two request handlers.</pre>
            <h4>Solr <a href="../../../../classes/Search.html">Search</a> Request Handlers</h4>
            <pre>When Blacklight does a collection search, it sends a request to a Solr&#x000A;request handler named &quot;search&quot;. The most important settings in this handler&#x000A;definition are the &quot;fl&quot; param (field list) and the facet params.&#x000A;&#x000A;The &quot;fl&quot; param specifies which fields are returned in a Solr response.&#x000A;The facet related params set up the faceting mechanism.&#x000A;&#x000A;Find out more about the basic params:&#x000A;   http://wiki.apache.org/solr/DisMaxRequestHandler&#x000A;&#x000A;Find out more about the faceting params:&#x000A;  http://wiki.apache.org/solr/SimpleFacetParameters</pre>
            <h5>How the &#8220;fl&#8221; param works in Blacklight&#8217;s request handlers</h5>
            <pre>Blacklight comes with a set of &quot;default&quot; views for rendering each document&#x000A;in a search results page. This view simply loops through all of the fields&#x000A;returned in each document in the Solr response. The &quot;fl&quot; (field list) param&#x000A;tells Solr which fields to include in the documents in the response ...&#x000A;and these are the fields rendered in the Blacklight default views.&#x000A;Thus, the fields you want rendered must be specified in &quot;fl&quot;.  Note that&#x000A;only &quot;stored&quot; fields will be available;  if you want a field to be rendered&#x000A;in the result, it must be &quot;stored&quot; per the field definition in schema.xml.&#x000A;&#x000A;The &quot;fl&quot; parameter definition in the &quot;search&quot; handler looks like this:&#x000A;  &lt;str name=&quot;fl&quot;&gt;*,score&lt;/str&gt;&#x000A;&#x000A;The asterisk could be replaced by a list of specific field names:&#x000A;  &lt;str name=&quot;fl&quot;&gt;id,title_t,score&lt;/str&gt;</pre>
            <h5>How the facet params work in Blacklight&#8217;s request handlers</h5>
            <pre>In the search results view, Blacklight will look into the Solr response for&#x000A;facets. If you specify any facet.field params in your &quot;search&quot; handler,&#x000A;they will automatically get displayed in the facets list:&#x000A;  &lt;str name=&quot;facet.field&quot;&gt;format_facet&lt;/str&gt;&#x000A;  &lt;str name=&quot;facet.field&quot;&gt;language_facet&lt;/str&gt;</pre>
            <h4>Blacklight&#8217;s &#8220;search&#8221; request handler: for search results</h4>
            <pre>When Blacklight displays a list of search results, it uses a Solr request&#x000A;handler named &quot;search.&quot; Thus, the field list (fl param) for the &quot;search&quot;&#x000A;request handler should be tailored to what will be displayed in a search&#x000A;results page.  Generally, this will not include fields containing a large&#x000A;quantity of text.  The facet param should contain the facets to be&#x000A;displayed with the search results.&#x000A;&#x000A;      &lt;requestHandler name=&quot;search&quot; class=&quot;solr.SearchHandler&quot; &gt;&#x000A;              &lt;lst name=&quot;defaults&quot;&gt;&#x000A;                      &lt;str name=&quot;defType&quot;&gt;dismax&lt;/str&gt;&#x000A;                      &lt;str name=&quot;echoParams&quot;&gt;explicit&lt;/str&gt;&#x000A;                      &lt;!-- list fields to be returned in the &quot;fl&quot; param --&gt;&#x000A;                      &lt;str name=&quot;fl&quot;&gt;*,score&lt;/str&gt;&#x000A;&#x000A;                      &lt;str name=&quot;facet&quot;&gt;on&lt;/str&gt;&#x000A;                      &lt;str name=&quot;facet.mincount&quot;&gt;1&lt;/str&gt;&#x000A;                      &lt;str name=&quot;facet.limit&quot;&gt;10&lt;/str&gt;&#x000A;&#x000A;                      &lt;!-- list fields to be displayed as facets here. --&gt;&#x000A;                  &lt;str name=&quot;facet.field&quot;&gt;format_facet&lt;/str&gt;&#x000A;                  &lt;str name=&quot;facet.field&quot;&gt;language_facet&lt;/str&gt;&#x000A;&#x000A;                      &lt;str name=&quot;q.alt&quot;&gt;*:*&lt;/str&gt;&#x000A;              &lt;/lst&gt;&#x000A;      &lt;/requestHandler&gt;</pre>
            <h4>Blacklight&#8217;s &#8220;document&#8221; request handler: for a single record</h4>
            <pre>When Blacklight displays a single record it uses a Solr request handler&#x000A;named &quot;document&quot;.  The &quot;document&quot; handler doesn't necessarily need to be&#x000A;different than the &quot;search&quot; handler, but it can be used to control which&#x000A;fields are available to display a single document. In the example below,&#x000A;there is no faceting set (facets are not displayed with a single record)&#x000A;and the &quot;rows&quot; param is set to 1 (since there will only be a single record).&#x000A;Also, the field list (&quot;fl&quot; param) could include fields containing large&#x000A;text values if they are desired for record display. Is is acceptable to&#x000A;include large amounts of data, because this handler should only be used&#x000A;to query for one document:&#x000A;&#x000A;      &lt;requestHandler name=&quot;document&quot; class=&quot;solr.SearchHandler&quot;&gt;&#x000A;              &lt;lst name=&quot;defaults&quot;&gt;&#x000A;                      &lt;str name=&quot;echoParams&quot;&gt;explicit&lt;/str&gt;&#x000A;                      &lt;str name=&quot;fl&quot;&gt;*&lt;/str&gt;&#x000A;                      &lt;str name=&quot;rows&quot;&gt;1&lt;/str&gt;&#x000A;                      &lt;str name=&quot;q&quot;&gt;{!raw f=id v=$id}&lt;/str&gt;&#x000A;                      &lt;!-- use id=blah instead of q=id:blah --&gt;&#x000A;              &lt;/lst&gt;&#x000A;      &lt;/requestHandler&gt;&#x000A;&#x000A;A Solr query for a single record might look like this:&#x000A; http://(yourSolrBaseUrl)/solr/select?id=my_doc_id&amp;qt=document</pre>
            <h4>Solr Schema and Solrconfig File Templates</h4>
            <pre>Blacklight provides schema.xml and solrconfig.xml files as starting points:&#x000A;&#x000A;  http://blacklight.rubyforge.org/svn/trunk/solr-templates/</pre>
            <h2>SolrMARC: from Marc data to Solr documents</h2>
            <pre>The SolrMARC project is designed to create a Solr index from raw MARC data.&#x000A;It can be configured easily and used with the basic parsing and indexing&#x000A;supplied.  It is also readily customized for a site's unique requirements.&#x000A;&#x000A;The project is available here:&#x000A;  http://code.google.com/p/solrmarc</pre>
            <h2>Anomalies and Other Odd Behavior</h2>
            <pre>We have experience an anomaly with _helper :all_ at runtime when compared&#x000A;with running the specs and features. When running specs and features, _helper :all_&#x000A;works as expected, _loading all helpers_. However, at runtime, all helpers&#x000A;are not being loaded up front. We have removed _helper :all_ from ApplicationController&#x000A;as it wasn't really needed. A notable difference between the environments is that&#x000A;specs and features are run in Blacklight as if it were a Rails app, whereas the demo&#x000A;is running Blacklight as a plugin engine. Perhaps there is a load issue when run as&#x000A;a plugin?</pre>
          </div>
          <div id='section'>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
